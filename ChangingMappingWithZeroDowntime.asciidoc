[[ChangingMappingWithZeroDowntime]]
== 不影响服务改变映射

原作者：Clinton Gormley Jun 17, 2013

译者：  殷春祥  July 14， 2014

PS：本文把mapping翻译成映射


一个我认识的开发人员给我发了一个推特说：
    _我使用Elasticsearch的最大问题是每次当我改变表的模式时我都要重新索引。有数据量很大会花很长的时间，
    并且期间不能提供服务。大部分应用都经常碰到这种情况。_

不停止服务区改变索引的映射是可行的，但是在tweet上说几种解决方法就太多了，所以有了这篇博文。

==== 问题-为什么你不能改变映射

你只能找到你存储在索引里的东西。为了使你的数据变得可以搜索，数据库需要知道每个字段包含的数据的类型，
以及它是如何索引的。如果你把一个数据类型比如 `string` 改成 `date`, 你索引的那个字段的所有数据就会变
成没用的。总之，你需要重新索引那个字段。

不只是Elasticsearch是这样，任何使用索引来搜索的数据库都是这样。如果不使用索引，那就因为灵活性而牺牲
了速度.

Elasticsearch(包括Lucene)把索引存储在不可变 _片段_ -- 每个片段是个 `"微型"` 倒排索引。这些分片从来不
适当更新。更新一个文档从来都是创建一个新文档让后标志老的文档为已删除。所以，你新加更多的文档(或者更新
已经存在的文档)，新的分片会被创建。后台运行的合并进程把几个小的分片合并成一个新的大的分片，然后老的分
片被彻底删除。




 

